---
layout: post
title: HDCON(2018) - 내부망 침투 가상 시나리오와 대응방법 및 개선에 따른 네트워크 구성
comments: true
---



*2018년 해킹방어 아이디어 공모전 (HDCON) 기준으로 작성해 본 시나리오 이다.*




# 1. 설명

HDCON은 한국인터넷진흥원(KISA) 주관의 정보보안기술 관련 콘테스트였다.

2018년 15회를 마지막으로 더 이상 운영하지 않는다.

2019년을 대비해서 2018년 끝 무렵에 가상 시나리오를 기반으로 작성해 보았으나, 더 이상 참가할 수 없게 되었다.

선택 주제는 '내부망 침투' 이다.



# 2. 아이디어 요약과 주요 활용기술


## 아이디어 요약

```
1. 현재 약 5,000 여개의 호스트가 3개의 서브네트워크로 구성 된 Victim을 업무망/비업무망 기준 2개의 서브네트워크로 단순화와 재분할
2. VPN 통해 비업무망 / 업무망 통신
3. Customizing 가능한 NGFW 통해 업무망 통신 및 보안강화
4. VRRP 통한 HA 구성으로 고가용성 보장
```


> **용어 설명**

* **VRRP** : Virtual Router Redundancy Protocol, 고가용성 확보를 위한 이중화 용도의 가상 라우터를 생성하는 기술

* **트랙** : 시스템 운용 중 설정된 조건에 따라서 주기적으로 검사를 수행하여 검사결과를 도출

* **클러스터링** : 클러스터링은 두 개의 노드를 하나의 노드처럼 보이게 만들어주는 부가적인 기능을 수행하는 것을 지칭한다. 작업부하 분산 클러스터링(Load Balancing)과 높은 가용성 클러스터(Hight Availability) 두 가지 측면이 있으며, 각각 Master – Master 구성과 Master – Slave 구성에 쓰인다.


## 주요 활용 기술

```
NGFW, 망분리(업무망,비업무망), VPN, HA
```


# 3. 문제 분석과 Request For Proposal

## 문제 분석
```
 1) Victim은 약 5,000대 이상 호스트 -> 3개의 서브 네트워크 (10.0.0.0/8 172.16.0.0/16 192.168.1.0/24) 로 운영되며 IDS, 샌드박스, 10M 이상 데이터 외부전송, IPS, 백신, DMZ망 운영 등으로 예방중심의 대응 중.
 
 2) Attacker는 약 100대 호스트에 접근 -> 내부정보 탈취해 5M 이하의 첨부파일 형태로 해외 서버에 지속적 유출 
```


## 제안 요청서


![IMAGE 002](https://user-images.githubusercontent.com/52769104/104817667-fe84f680-5865-11eb-9b1f-1cb01ad61c9d.png)







# 4. 네트워크 구성도와 대응 방법



![IMAGE 004](https://user-images.githubusercontent.com/52769104/104817669-004eba00-5866-11eb-8063-fa947da818b3.png)









> 구성

- 3개의 서브 네트워크를 업무망 / 비업무망 2개의 서브네트워크 구성으로 재분할 및 간소화 하며, HA를 확보한 NGFW를 반드시 거쳐 나가게 구성하였다.

> 연결

- 기존의 인터넷 구간을 활용한 단순 라우팅 연결에서, A네트워크와 B네트워크 간에 암복호화 통신을 수행하는 VPN IPSec을 활용하여 Tunneling을 사용하도록 구축하였다. 이를 통해서 중간 구간에서 누군가 패킷을 가로채더라도, 암호화 된 패킷이므로 A네트워크와 B네트워크의 통신에 있어서의 정보유출 우려를 줄였다.

> 감시

- 기존에 설치된 IDS 외에도 또한 NG급 방화벽을 사용함으로써 Deep Packet Inspection이 가능해 외부 반출 가능한 파일 용량의 설정, 서비스 사용 범위의 설정, Traffic Anomaly상황에 대해 빠른 파악이 가능하도록 설정하였다. 

> 고가용성

- 기존의 고가용성 지원을 위한 HA구성을 통해 Fail Over 구성되었다.

> Dynamic NAT

- 내부망 주소를 감추기 위해서 외부 통신을 연결할 때 Dynamic NAT를 수행한다.

> Port NAT

- 기존의 A네트워크 Web Server와 B네트워크 간 통신에 사용되는 Telnet에 대한 외부연결 가능 여부를 넘어서, 방화벽의 방어기능을 통한 보안 향상과 접속의 용이성을 유지하기 위한 Port NAT를 수행한다.




![IMAGE 003](https://user-images.githubusercontent.com/52769104/104817668-ffb62380-5865-11eb-849d-268d6d1845cf.png)




# 5. 최종 결과

```
- 기존의 예방중심 네트워크에 업무망 / 비업무망으로 구분하여 보안과 가용성을 강화하였다. 


 - A네트워크의 게이트웨이를 방화벽으로 구축하고, 이를 이중화로 구성하여 가용성과 보안성을 높였고, 기존에 외부에 노출되어 있는 IP를 Dynamic NAT와 Port Nat를 이용하여 목적지와 도착지 IP를 숨겼다. 


 - 기존 자원은 사용하되 NGFW를 추가 도입하여 Customizing 가능한 보안 서비스를 강화하였다.


 - 기존의 전용선을 VPN으로 대체하여 클라이언트 사이에 주고받는 모든 데이터를 암호화하여 데이터를 보호할 수 있게 했다.  - B네트워크는 A네트워크를 통해서만 인터넷 통신을 하게 되어 있다. 그래서 기본 게이트웨이가 장애가 생기면 외부와 통신할 수 없었지만, 공중망을 이용하는 VPN을 통해 B네트워크의 게이트웨이가 장애가 생겨도 비상시에 외부 인터넷에 접근 할 수 있게 되어서 가용성이 한층 더 보장되었다.


 - 고 가용성 확보를 위한 ++VRRP 작업++을 하기 위해선, 일반적으로 ++트랙++과 ++클러스터링 작업++이 필요하다. 트랙은 VRRP의 해당 인터페이스끼리 연결되어있는지 주기적으로 검사를 수행한다. 또한, 클러스터링을 통해서 하나의 그룹으로 묶어 세션정보, 헬스체크 등의 기능을 수행하기 위해 필요하다. (장비 내부에서의 정상 작동 여부의 판단은 트랙이 수행하고, 장비 서로간의 정상 작동 여부 판단은 클러스터링을 통해서 확인한다.)
```




## 이 네트워크 구성이 성공적인지 공모전 제출을 통해 검증이 필요했으나, 실체화 되지 않아 아쉬운 마음에 이 블로그에 올린다. 다른 대회가 있으면 또 도전해 봐야지 !!
